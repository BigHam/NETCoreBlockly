!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],t);else{var i="object"==typeof exports?t(require("blockly/core")):t(e.Blockly);for(var n in i)("object"==typeof exports?exports:e)[n]=i[n]}}(this,(function(e){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/dist/",i(i.s=1)}([function(t,i){t.exports=e},function(e,t,i){"use strict";i.r(t),i.d(t,"WorkspaceSearch",(function(){return h}));
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
var n,r=["path.blocklyPath.blockly-ws-search-highlight {","fill: black;","}","path.blocklyPath.blockly-ws-search-highlight.blockly-ws-search-current {","fill: grey;","}",".blockly-ws-search-close-btn {","background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=) no-repeat top left;","}",".blockly-ws-search-next-btn {","background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSA4LjU5TDEyIDEzLjE3bDQuNTktNC41OEwxOCAxMGwtNiA2LTYtNiAxLjQxLTEuNDF6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PC9zdmc+) no-repeat top left;","}",".blockly-ws-search-previous-btn {","background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSAxNS40MUwxMiAxMC44M2w0LjU5IDQuNThMMTggMTRsLTYtNi02IDZ6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==) no-repeat top left;","}",".blockly-ws-search {","background: white;","border: solid lightgrey .5px;","box-shadow: 0px 10px 20px grey;","justify-content: center;","padding: .25em;","position: absolute;","z-index: 70;","}",".blockly-ws-search-input input {","border: none;","}",".blockly-ws-search button {","border: none;","}",".blockly-ws-search-actions {","display: flex;","}",".blockly-ws-search-container {","display: flex;","}",".blockly-ws-search-content {","display: flex;","}"],o=(n=!1,function(){if(!n){n=!0;var e=r.join("\n"),t=document.createElement("style");t.id="blockly-ws-search-style";var i=document.createTextNode(e);t.appendChild(i),document.head.insertBefore(t,document.head.firstChild)}}),s=i(0);function l(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return c(e,t)}(e))){var t=0,i=function(){};return{s:i,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workspace_=t,this.htmlDiv_=null,this.actionDiv_=null,this.inputElement_=null,this.textInputPlaceholder_="Search",this.blocks_=[],this.currentBlockIndex_=-1,this.searchText_="",this.searchOnInput=!0,this.caseSensitive=!1,this.preserveSelected=!0,this.boundEvents_=[]}var t,i,n;return t=e,(i=[{key:"init",value:function(){o(),this.createDom_(),this.setVisible_(!1)}},{key:"dispose",value:function(){var e,t=l(this.boundEvents_);try{for(t.s();!(e=t.n()).done;){var i=e.value;s.unbindEvent_(i)}}catch(e){t.e(e)}finally{t.f()}this.boundEvents_=null,this.htmlDiv_&&(this.htmlDiv_.remove(),this.htmlDiv_=null),this.actionDiv_=null,this.inputElement_=null}},{key:"createDom_",value:function(){var e=this,t=this.workspace_.getInjectionDiv();this.addEvent_(t,"keydown",this,(function(t){return e.onWorkspaceKeyDown_(t)})),this.htmlDiv_=document.createElement("div"),s.utils.dom.addClass(this.htmlDiv_,"blockly-ws-search"),this.positionSearchBar_();var i=document.createElement("div");s.utils.dom.addClass(i,"blockly-ws-search-container");var n=document.createElement("div");s.utils.dom.addClass(n,"blockly-ws-search-content"),i.appendChild(n);var r=document.createElement("div");s.utils.dom.addClass(r,"blockly-ws-search-input"),this.inputElement_=this.createTextInput_(),this.addEvent_(this.inputElement_,"keydown",this,(function(t){return e.onKeyDown_(t)})),this.addEvent_(this.inputElement_,"input",this,(function(){return e.onInput_()})),this.addEvent_(this.inputElement_,"click",this,(function(){return e.searchAndHighlight(e.searchText_,e.preserveSelected)})),r.appendChild(this.inputElement_),n.appendChild(r),this.actionDiv_=document.createElement("div"),s.utils.dom.addClass(this.actionDiv_,"blockly-ws-search-actions"),n.appendChild(this.actionDiv_);var o=this.createNextBtn_();o&&this.addActionBtn(o,(function(){return e.next()}));var l=this.createPreviousBtn_();l&&this.addActionBtn(l,(function(){return e.previous()}));var c=this.createCloseBtn_();c&&(this.addBtnListener_(c,(function(){return e.close()})),i.appendChild(c)),this.htmlDiv_.appendChild(i),t.insertBefore(this.htmlDiv_,this.workspace_.getParentSvg())}},{key:"addEvent_",value:function(e,t,i,n){var r=s.bindEventWithChecks_(e,t,i,n);this.boundEvents_.push(r)}},{key:"addActionBtn",value:function(e,t){this.addBtnListener_(e,t),this.actionDiv_.appendChild(e)}},{key:"createTextInput_",value:function(){var e=document.createElement("input");return e.type="text",e.setAttribute("placeholder",this.textInputPlaceholder_),e}},{key:"createNextBtn_",value:function(){return this.createBtn_("blockly-ws-search-next-btn","Find next")}},{key:"createPreviousBtn_",value:function(){return this.createBtn_("blockly-ws-search-previous-btn","Find previous")}},{key:"createCloseBtn_",value:function(){return this.createBtn_("blockly-ws-search-close-btn","Close search bar")}},{key:"createBtn_",value:function(e,t){var i=document.createElement("button");return s.utils.dom.addClass(i,e),i.setAttribute("aria-label",t),i}},{key:"addBtnListener_",value:function(e,t){var i=this;this.addEvent_(e,"click",this,t),this.addEvent_(e,"keydown",this,(function(e){e.keyCode===s.utils.KeyCodes.ENTER?(t(e),e.preventDefault()):e.keyCode===s.utils.KeyCodes.ESC&&i.close(),e.stopPropagation()}))}},{key:"positionSearchBar_",value:function(){var e=this.workspace_.getMetrics();this.workspace_.RTL?this.htmlDiv_.style.left=e.absoluteLeft+"px":e.toolboxPosition===s.TOOLBOX_AT_RIGHT?this.htmlDiv_.style.right=e.toolboxWidth+"px":this.htmlDiv_.style.right="0",this.htmlDiv_.style.top=e.absoluteTop+"px"}},{key:"onInput_",value:function(){if(this.searchOnInput){var e=this.inputElement_.value.trim();e!==this.searchText_&&this.searchAndHighlight(e,this.preserveSelected)}}},{key:"onKeyDown_",value:function(e){if(e.keyCode===s.utils.KeyCodes.ESC)this.close();else if(e.keyCode===s.utils.KeyCodes.ENTER)if(this.searchOnInput)this.next();else{var t=this.inputElement_.value.trim();t!==this.searchText_&&this.searchAndHighlight(t,this.preserveSelected)}}},{key:"onWorkspaceKeyDown_",value:function(e){(e.ctrlKey||e.metaKey)&&e.keyCode===s.utils.KeyCodes.F&&(this.open(),e.preventDefault(),e.stopPropagation())}},{key:"previous",value:function(){this.setCurrentBlock_(this.currentBlockIndex_-1)}},{key:"next",value:function(){this.setCurrentBlock_(this.currentBlockIndex_+1)}},{key:"setSearchPlaceholder",value:function(e){this.textInputPlaceholder_=e,this.inputElement_&&this.inputElement_.setAttribute("placeholder",this.textInputPlaceholder_)}},{key:"setCurrentBlock_",value:function(e){if(this.blocks_.length){var t=this.blocks_[this.currentBlockIndex_];t&&this.unhighlightCurrentSelection_(t),this.currentBlockIndex_=(e%this.blocks_.length+this.blocks_.length)%this.blocks_.length,t=this.blocks_[this.currentBlockIndex_],this.highlightCurrentSelection_(t),this.updateCursor_(t),this.scrollToVisible_(t)}}},{key:"open",value:function(){this.setVisible_(!0),this.markCurrentPosition_(),this.inputElement_.focus(),this.searchText_&&this.searchAndHighlight(this.searchText_)}},{key:"markCurrentPosition_",value:function(){var e=this.workspace_.getMarker(s.navigation.MARKER_NAME);if(this.workspace_.keyboardAccessibilityMode&&e&&!e.getCurNode()){var t=this.workspace_.getCursor().getCurNode();e.setCurNode(t)}}},{key:"close",value:function(){this.setVisible_(!1),this.workspace_.markFocused(),this.clearBlocks()}},{key:"setVisible_",value:function(e){this.htmlDiv_.style.display=e?"flex":"none"}},{key:"searchAndHighlight",value:function(e,t){var i=this.blocks_[this.currentBlockIndex_];this.searchText_=e.trim(),this.clearBlocks(),this.blocks_=this.getMatchingBlocks_(this.workspace_,this.searchText_,this.caseSensitive),this.highlightSearchGroup_(this.blocks_);var n=0;t&&(n=(n=this.blocks_.indexOf(i))>-1?n:0),this.setCurrentBlock_(n)}},{key:"getSearchPool_",value:function(e){return e.getAllBlocks(!0).filter((function(e){var t=e.getSurroundParent();return!t||!t.isCollapsed()}))}},{key:"isBlockMatch_",value:function(e,t,i){var n="";if(e.isCollapsed())n=e.toString();else{var r=[];e.inputList.forEach((function(e){e.fieldRow.forEach((function(e){r.push(e.getText())}))})),n=r.join(" ").trim()}return i||(n=n.toLowerCase()),n.indexOf(t)>-1}},{key:"getMatchingBlocks_",value:function(e,t,i){var n=this;return t?(this.caseSensitive||(t=t.toLowerCase()),this.getSearchPool_(e).filter((function(e){return n.isBlockMatch_(e,t,i)}))):[]}},{key:"clearBlocks",value:function(){this.unhighlightSearchGroup_(this.blocks_);var e=this.blocks_[this.currentBlockIndex_];e&&this.unhighlightCurrentSelection_(e),this.currentBlockIndex_=-1,this.blocks_=[]}},{key:"updateCursor_",value:function(e){if(this.workspace_.keyboardAccessibilityMode){var t=s.navigation.getTopNode(e);this.workspace_.getCursor().setCurNode(t)}}},{key:"highlightCurrentSelection_",value:function(e){var t=e.pathObject.svgPath;s.utils.dom.addClass(t,"blockly-ws-search-current")}},{key:"unhighlightCurrentSelection_",value:function(e){var t=e.pathObject.svgPath;s.utils.dom.removeClass(t,"blockly-ws-search-current")}},{key:"highlightSearchGroup_",value:function(e){e.forEach((function(e){var t=e.pathObject.svgPath;s.utils.dom.addClass(t,"blockly-ws-search-highlight")}))}},{key:"unhighlightSearchGroup_",value:function(e){e.forEach((function(e){var t=e.pathObject.svgPath;s.utils.dom.removeClass(t,"blockly-ws-search-highlight")}))}},{key:"scrollToVisible_",value:function(e){if(this.workspace_.isMovable()){var t=e.getRelativeToSurfaceXY(),i=this.workspace_.scale,n=e.width*i,r=e.height*i,o=t.y*i,s=(t.y+e.height)*i,l=this.workspace_.RTL?t.x*i-n:t.x*i,c=this.workspace_.RTL?t.x*i:t.x*i+n,a=this.workspace_.getMetrics(),h=a.viewLeft,u=l<a.viewLeft,d=c>a.viewLeft+a.viewWidth,v=n>a.viewWidth;!v&&u||v&&!this.workspace_.RTL?h=l:(!v&&d||v&&this.workspace_.RTL)&&(h=c-a.viewWidth);var p=a.viewTop,f=o<a.viewTop,y=s>a.viewTop+a.viewHeight,_=r>a.viewHeight;if(f||_&&y?p=o:y&&(p=s-a.viewHeight),h!==a.viewLeft||p!==a.viewTop){var k=document.activeElement;this.workspace_.scroll(-h,-p),k&&k.focus()}}}}])&&a(t.prototype,i),n&&a(t,n),e}();
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */}])}));
//# sourceMappingURL=index.js.map